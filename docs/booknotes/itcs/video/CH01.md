## 计算机系统概述

<center>
     <div>
         <span>
             <img src="../../../.vuepress/public/img/作者.svg" width="20px">
             ：yijiu &emsp;&emsp;
         </span>
        &emsp;
         <span>
             <img src="../../../.vuepress/public/img/时间.svg" width="20px">
             ：2019.11.20 &emsp;&emsp;
         </span>
         &emsp;
         <span>
             <img src="../../../.vuepress/public/img/标签.svg" width="20px">
             ：基础 &emsp;&emsp;
         </span>
     </div>
 </center>

---

## 第1讲  为什么要学习计算机系统基础

### 什么是计算机系统？

![计算机系统](https://yijiu-blog.oss-cn-hongkong.aliyuncs.com/images/booknotes/itcs/CH01/1.1.1%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F.png?x-oss-process=style/blog-image)

> 课程目标：清楚理解计算机是如何生成和运行可执行文件的



#### 抽象层

抽象层是在高级语言层下的（重点掌握）

**C 语言程序设计层**

- 数据的机器级表示、运算
- 语句和过程调用的机器级表示

**操作系统、编译和链接的部分内容**

**指令集体系结构（ISA）和汇编层**

- 指令系统、机器代码、汇编语言

**微体系结构及硬件层**

- CPU 的通用结构
- 层次结构存储系统



#### 为什么要学习“计算机系统基础”

- 为了编程时少出错
- 为了在程序出错时很快找到出错的地方
- 为了明白程序是怎么在计算机上执行的
- 为了强化 “系统思维”

- 为了更好地理解计算机系统，从而编写出更好的程序
- 为了编写出更快的程序
- 打下良好基础
- 为了更好地认识计算机系统



## 第2讲 计算机系统基本组成与基本功能

###  冯·诺伊曼结构主要思想

最重要的思想：“**存储程序**（Stored-program）”。

**工作方式：**

- 任何要计算机完成的工作都要先被编写成程序，然后将程序和原始数据送入主存并启动执行。一旦程序被启动，计算机应能在不需操作人员的干预下，自动完成逐条取出指令和执行指令的任务。

大都通用计算机采用了冯·诺依曼结构。

**冯诺依曼结构：**

![冯诺依曼结构计算机模型](https://yijiu-blog.oss-cn-hongkong.aliyuncs.com/images/booknotes/itcs/CH01/1.2.1%E5%86%AF%E8%AF%BA%E4%BE%9D%E6%9B%BC%E7%BB%93%E6%9E%84%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%A8%A1%E5%9E%8B.png?x-oss-process=style/blog-image)

**冯·诺依曼结构的主要思想**

- 计算机应由**运算器、控制器、存储器、输入设备和输出设备**五个基本部件组成。

  各个基本部件的功能是：

- **存储器**不仅能存放数据，而且也能存放指令，形式上两者无区别，但计算机应能区分数据和指令。

- **控制器**应能自动取出指令来执行。

- **运算器**应能进行加/减/乘/除四种基本算术运算，并且也能进行一些逻辑运算和附加运算。

- 操作人员可以通过**输入设备**、**输出设备**和主机进行通信。

- 内部以**二进制表示**指令和数据。每条指令由**操作码**和**地址码**两部分组成。由一串指令组成程序。

  - 操作码指出操作类型。
  - 地址码指出操作数的地址

- 采用**存储程序**工作方式。



### 现代计算机结构模型

![现代计算机结构模型](https://yijiu-blog.oss-cn-hongkong.aliyuncs.com/images/booknotes/itcs/CH01/1.2.2%E7%8E%B0%E4%BB%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%93%E6%9E%84%E6%A8%A1%E5%9E%8B.png?x-oss-process=style/blog-image)



#### 计算机工作方式：“存储程序”

**程序在执行前：**

- 数据和指令事先存放在存储器中，每条指令和每个数据都有地址，指令按序存放，指令由OP、ADDR 字段组成，程序气质地址置 PC。

**开始执行程序：**

- 根据 PC 取指令
- 指令译码
- 取操作数
- 指令执行
- 回写结果
- 修改 PC 值
- 继续执行下一条指令



#### 指令和数据

- 程序启动前，指令和数据存放在存储器中，形式是 0/1序列。
- 采用“存储程序”工作方式，计算机自动取出指令执行。
- 指令执行过程中，指令和数据从存储器取到 CPU ，存放在 CPU 内的寄存器中，**指令在 IR 中，数据在 GPR 中**。

**指令中需给出的信息：**

- 操作性质（操作码）
- 源操作数1 或/和 源操作数2   （立即数、寄存器编号、存储地址）
- 目的操作数地址  （寄存器编号、存储地址）
- 存储地址的描述与操作数的数据结构有关



#### 计算机的基本组成与基本功能

**计算机的基本部件和功能：**

- 运算器（数据运算）：ALU、GPRs、标志寄存器等
- 存储器（数据存储）：存储阵列、地址译码器、读写控制电路
- 总线（数据传送）：数据（MDR）、地址（MAR）、控制线
- 控制器（控制）：对指令译码生成控制信号



> 计算机实现的所有任务都是通过执行一条一条指令完成的。





## 第3讲 程序开发和执行过程简介

### 从机器语言到高级编程语言

机器语言编写的程序：是**0/1序列**。

**汇编语言：**

- 用**助记符**表示操作码 
- 用**标号**表示位置
- 用助记符表示寄存器

**汇编语言的优点：**

- 不会因为增减指令而需要修改其他指令
- 不需记忆指令编码，编写方便
- 可读性比机器语言强

机器不认识汇编语言指令，需将汇编语言转换成机器语言（用汇编程序转换）。

#### 汇编指令

> 汇编语言(源)程序由汇编指令构成

**描述：**

- 用助记符和标号来表示的指令（与机器指令一一对应）

**指令：**

- 包含操作码和操作数或其地址码
  - 机器指令用二进制表示，汇编指令用符号表示

- 只能描述：
  - 取（或存一个数）
  - 两个数相加（或减、乘、除、与、或等）
  - 根据运算结果判断是否转移执行

> 汇编语言十分麻烦，且编写复制程序会很吃力。

#### 高级语言开发程序

**高级语言：**

- 与具体机器结构无关

- 面向算法描述，描述能力比机器级语言强

- 高级语言一条语句可以对应几条、几十几百条指令

- 有“**面向过程**”和“**面向对象**”的语言之分

- 处理逻辑分为三种结构

  - 顺序结构
  - 选择结构
  - 循环结构

- 有两种转换方式：“编译” 和 “解释”

  - **编译程序**(Complier)：将高级语言源程序转换成机器级目标程序，执行时只要启动目标程序（可执行文件）即可。
  - **解释程序**(Interpreter)：将高级语言语句逐条翻译成机器指令并立刻执行，不生成目标文件。




### 程序的开发和执行及其支撑环境

#### 程序的转换处理过程

hello.c-源程序

```c
#include<stdio.h>

int main()
{
    printf("hello, world\n");
}
```

功能：输出 “hello, world”

计算机不能直接执行 hello.c

![1.3.2gcc处理过程](https://yijiu-blog.oss-cn-hongkong.aliyuncs.com/images/booknotes/itcs/CH01/1.3.2gcc%E5%A4%84%E7%90%86%E8%BF%87%E7%A8%8B.png?x-oss-process=style/blog-image)

执行方式：

```sh
$ ./hello
hello, world
$
```

hello程序的数据流动过程：

- Red：shell命令行处理
- Blue：可执行文件加载
- Cyan：hello程序执行过程

数据经常在各存储部件间传送。故现代计算机大多采用“**缓存**”技术。

所以过程都是在 CPU 执行指令所产生的控制信号的作用下进行的。

任何高级语言程序最终通过执行若干条指令来完成。

#### 支撑环境

- 编辑器编写源程序
- 翻译转换软件
  - 编译方式：预处理程序、编译器、汇编器、链接器
  - 解释方式：解释程序
- 执行程序的界面
  - GUI 方式：图形用户界面
  - CUI 方式：命令行用户界面

支持环境由系统软件提供

最重要的系统软件：操作系统+语言处理系统

语言处理系统运行在操作系统之上，操作系统利用指令管理硬件





## 第4讲 计算机系统层次结构

### 编程语言和计算机系统层次

#### 计算机系统的层次

- 最早的计算机用机器语言编程

 ![1.4.1机器语言](https://yijiu-blog.oss-cn-hongkong.aliyuncs.com/images/booknotes/itcs/CH01/1.4.1%E6%9C%BA%E5%99%A8%E8%AF%AD%E8%A8%80.png?x-oss-process=style/blog-image)

- 后来用汇编语言编程

![1.4.1汇编语言](https://yijiu-blog.oss-cn-hongkong.aliyuncs.com/images/booknotes/itcs/CH01/1.4.1%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80.png?x-oss-process=style/blog-image)

- 现代计算机用高级语言编程
  - 过程式语言
  - 非过程式语言

![1.4.1高级语言](https://yijiu-blog.oss-cn-hongkong.aliyuncs.com/images/booknotes/itcs/CH01/1.4.1%E9%AB%98%E7%BA%A7%E8%AF%AD%E8%A8%80.png?x-oss-process=style/blog-image)

**语言处理系统**

- 各种语言处理系统（如编译、汇编、链接）
- 运行时系统（如库函数、调试、优化等）

**操作系统**

- 人机交互界面
- 内核



### 现代计算机系统的层次结构

#### 计算机系统抽象层的转换

![1.4.2系统抽象层](https://yijiu-blog.oss-cn-hongkong.aliyuncs.com/images/booknotes/itcs/CH01/1.4.2%E7%B3%BB%E7%BB%9F%E6%8A%BD%E8%B1%A1%E5%B1%82.png?x-oss-process=style/blog-image)



![1.4.2用户](https://yijiu-blog.oss-cn-hongkong.aliyuncs.com/images/booknotes/itcs/CH01/1.4.2%E7%94%A8%E6%88%B7.png?x-oss-process=style/blog-image)



#### 指令集体系结构（ISA）

`ISA` 指 Instruction Set Architecture，即**指令集体系结构**，有时简称为指令系统。

`ISA` 是一种**规约**（Specification），它规定了软件如何使用硬件。

- 可执行指令的集合，包括**指令格式**、**操作种类**以及每种操作对应的操作数的相应规定
- 指令可以接受的**操作数的类型**

- 操作数所能存放的寄存器组的结构，包括每个**寄存器的名称、编号、长度和用途**

- 操作数所能存放的**存储空间大小和编址方式**
- 操作数在存储空间存放时按照**大端还是小端**方式存放
- 指令获取操作数的方式，即**寻址方式**
- 指令执行过程的控制方式，**包括程序计数器（PC）、条件码定义**等

ISA 是通用计算机系统中必不可少的一个抽象层。

ISA 使得软件可以使用计算机硬件，它是通用计算机标准。

ISA 是计算机组成（微体系结构）的**抽象**。

不同 ISA 规定的指令集不同，如：IA-32、MIPS、ARM等。



## 第5讲 本课程的主要学习内容

#### 应用程序员的要求

- 编写高效程序必须了解计算机底层结构
- 必须掌握并行程序设计技术和工具
- 应用问题更复杂、领域更广

> 大规模、分布式、多粒度并行，并行成为重要主题

#### 程序员的角度认识计算机系统

- 构建完整的计算机系统概念
- 为后续 OS、编译、体系结构等课程打下坚实基础

平台：**IA-32 + Linux + C + gcc** （开源）

**课程主要内容：描述程序执行的底层机制**

### 课程内容概要（围绕程序）

- 数据的表示
- 数据的运算
- 各类语句的转换与表示（指令）
- 各类复杂数据类型的转换表示
- 过程（函数）调用的转换表示
- 链接（linker）和加载
- 程序执行（存储器访问）
- 异常和中断处理
- 输入输出（I/O）

**课程目标：理解计算机是如何生成和运行可执行文件的**

#### 课程重点在高级语言以下各抽象层

- C 语言程序设计层
  - 数据的机器级表示、运算
  - 语句和过程调用的机器级表示
- 指令集体系结构（ISA）和汇编层
  - 指令系统、机器代码、汇编语言
- 微体系结构及硬件层
  - CPU 通用结构
  - 层次结构存储系统
- 操作系统、编译、链接的部分内容

#### 三个主题

- 表示
  - 不同数据类型
  - 指令表示编码
  - 存储地址表示
- 转换
  - 高级语言->机器级语言
  - 转换链接可执行文件
- 执行控制流
  - 程序的组织
  - 多程序并发执行
  - 异常事件、中断事件处理
  - I/O 操作的执行控制流（用户态->内核态）

#### 课程内容

- 计算机系统概述

- 数据的机器级表示与处理

- 程序的转换及机器级表示

- 程序的链接

  